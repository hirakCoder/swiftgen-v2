<!DOCTYPE html>
<html>
<head>
    <title>Modification Test</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #fff; }
        button { padding: 10px 20px; margin: 10px; cursor: pointer; }
        #output { background: #000; padding: 20px; margin-top: 20px; white-space: pre-wrap; }
        .success { color: #0f0; }
        .error { color: #f00; }
        .info { color: #0ff; }
    </style>
</head>
<body>
    <h1>SwiftGen Modification Test</h1>
    
    <div>
        <button onclick="createApp()">1. Create Counter App</button>
        <button onclick="modifyApp()" id="modifyBtn" disabled>2. Add Dark Mode Toggle</button>
        <button onclick="modifyApp2()" id="modifyBtn2" disabled>3. Add Reset Button</button>
    </div>
    
    <div id="output"></div>
    
    <script>
        let currentProjectId = null;
        
        function log(msg, type = 'info') {
            const output = document.getElementById('output');
            output.innerHTML += `<span class="${type}">${new Date().toLocaleTimeString()} - ${msg}</span>\n`;
            output.scrollTop = output.scrollHeight;
        }
        
        async function createApp() {
            log('Creating counter app...');
            
            try {
                const response = await fetch('/api/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        description: 'Create a simple counter app',
                        app_name: 'TestCounter',
                        project_id: 'test_ui_' + Date.now()
                    })
                });
                
                const result = await response.json();
                log(`Response: ${JSON.stringify(result, null, 2)}`);
                
                if (result.success) {
                    currentProjectId = result.project_id;
                    log(`✅ App created! Project ID: ${currentProjectId}`, 'success');
                    document.getElementById('modifyBtn').disabled = false;
                    document.getElementById('modifyBtn2').disabled = false;
                } else {
                    log(`❌ Failed: ${result.error}`, 'error');
                }
            } catch (error) {
                log(`❌ Error: ${error.message}`, 'error');
            }
        }
        
        async function modifyApp() {
            if (!currentProjectId) {
                log('❌ No project ID! Create an app first.', 'error');
                return;
            }
            
            log(`Modifying app ${currentProjectId} - adding dark mode...`);
            
            try {
                const response = await fetch('/api/modify', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        project_id: currentProjectId,
                        description: 'Add a dark mode toggle',
                        app_name: 'TestCounter'
                    })
                });
                
                const result = await response.json();
                log(`Response: ${JSON.stringify(result, null, 2)}`);
                
                if (result.success) {
                    log(`✅ Modification successful!`, 'success');
                } else {
                    log(`❌ Modification failed: ${result.error}`, 'error');
                }
            } catch (error) {
                log(`❌ Error: ${error.message}`, 'error');
            }
        }
        
        async function modifyApp2() {
            if (!currentProjectId) {
                log('❌ No project ID! Create an app first.', 'error');
                return;
            }
            
            log(`Modifying app ${currentProjectId} - adding reset button...`);
            
            try {
                const response = await fetch('/api/modify', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        project_id: currentProjectId,
                        description: 'Add a reset button',
                        app_name: 'TestCounter'
                    })
                });
                
                const result = await response.json();
                log(`Response: ${JSON.stringify(result, null, 2)}`);
                
                if (result.success) {
                    log(`✅ Modification successful!`, 'success');
                } else {
                    log(`❌ Modification failed: ${result.error}`, 'error');
                }
            } catch (error) {
                log(`❌ Error: ${error.message}`, 'error');
            }
        }
        
        log('Test page ready. Click "Create Counter App" to start.', 'info');
    </script>
</body>
</html>